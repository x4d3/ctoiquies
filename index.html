<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" >
	<head>
		<title>C'est toi qui es...</title>
		<meta name="keywords" content="C'est toi qui es">
		<meta name="description" content="L'outil indispensable d'une bonne répartie">
		<meta name="Language" CONTENT="fr">
		<meta content="text/html; Charset=UTF-8" http-equiv="Content-Type" />
		<meta http-equiv="Content-Language" content="fr">
		<style type="text/css">
			body {
				background-color:black;
				text-align:center;
				font-family: Garamond;
				color: white;
				margin: 0px;
			}
			h2{
				margin:0;
				margin-top: 2%;
				margin-bottom: 1%;
				font-size: 400%;
			}
			h3{
				margin:0;
				margin-bottom: 1%;
				font-size: 200%;
			}
			#linkGetter{
				margin-top:4%;
			}
			#link{
				margin-top:1%;
			}
		</style>
		
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-22989604-1', 'auto');
		  ga('send', 'pageview');

		</script>

		<script src="jquery-1.5.2.min.js"></script>
		<script type="text/javascript">
			var getShortUrl = function(url, callback){
				$.getJSON("http://api.bitly.com/v3/shorten?callback=?", 
					{ 
						"format": "json",
						"apiKey": 'R_476c40c75ba9a8cfd9e0f2fb60f5d7e2',
						"login": 'ctoiquies',
						"longUrl": url
					},
					function(response){callback(response.data.url);}
				);
			};
			
			var _processLink = function(createInput){
				var adj = $("#linkInput").val()
					.replace(/[ ]/g,"_");
				var url =  "http://ctoiqui.es/" + adj;
				var link = $("#link");
				link.empty();
				var linkInput = createInput(url);
				link.append(linkInput);
				linkInput.focus();
				linkInput.select();
			};

			var _createInput = function(url){
				return $("<input/>").attr("value",url);
			};
			
			var _createShortInput = function(url){
				var input = _createInput(url);
				getShortUrl(url, function(shortUrl){
					input.attr("value",shortUrl);
					input.focus();
					input.select();
				});
				return input;
			};
			
			function getLink() {
				_processLink(_createInput);
			};

			function getShortLink() {
				_processLink(_createShortInput);
			};
			
			 $(document).ready(function() {
				$('#linkInput').keypress(function(e){
				  if(e.which == 13){
					getLink();
					e.preventDefault();
					return false;
				   }
				  });
			 });
		</script> 
	</head>

   <body>
		<h2>ctoiqui.es</h2>
		<p>Une répartie sans égales.</p>
	   <div id="linkGetter">
			<h3> Créer un lien</h3>
			<div>
			<p>C'est toi qui es <input type = "text" name ="linkInput" id ="linkInput" size = 10 value = "moche"> </p>
			<p>
				<input type="button" value="Long" onclick="getLink()">
				<input type="button" value="Court" onclick="getShortLink()">
			</p>
			</div>
	   </div >
	   <div id="link"/>
  </body>
</html>

